---
- name: Create a ticket
  snow_record:
    username: admin
    password: uM2YBSyKpdn1
    instance: dev112400
    state: present
    table: change_request
    data:
        u_environment: "{{item.Environment}}"
        cmdb_ci: "{{item.CI}}"
        start_date: "{{item.start_date}}"
        end_date: "{{item.end_date}}"
        short_description: "{{item.Short_Description}}"
        category: "{{item.Category}}"
        assignment_group: "{{item.Assigned_Group}}"
        assigned_to: "{{item.Assigned_To}}"
        implementation_plan: "{{item.Implemention_Plan}}"
        backout_plan: "{{item.BackoutPlan}}"
        description: 'PRM CHANGE CREATION'
  register: new_change
- debug:
    msg: "New change has been created : {{ new_change.record.number }} "
- name: test change
  snow_record:
    username: admin
    password: uM2YBSyKpdn1
    instance: dev112400
    state: present
    table: change_task
    data:
      short_description: "Sample Task Creation for Change {{ new_change.record.number }}"
      description: 'Nishant 2021| NON PROD Q3 Linux Patching QA'
      change_request: "{{ new_change.record.number }}"
  register: change_task
- debug:
    msg: "New change has been created : {{ change_task.record.number }} "  
  